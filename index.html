<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Notebooks - Leil√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: #f5f5f5;
            font-size: 16px;
            font-weight: 600;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .card .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .resultado {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .resultado h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .resultado-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .resultado-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2em;
            color: #667eea;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pendente {
            background: #ffeaa7;
            color: #d63031;
        }

        .status-vendido {
            background: #55efc4;
            color: #00b894;
        }

        .alerta {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üíª Gest√£o de Notebooks - Leil√£o</h1>
            <p>Controle completo de compra, venda e lucro</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="openTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="openTab('compra')">‚ûï Nova Compra</button>
            <button class="tab" onclick="openTab('despesas')">üí∞ Despesas</button>
            <button class="tab" onclick="openTab('calculo')">üßÆ Calcular Venda</button>
            <button class="tab" onclick="openTab('vendas')">‚úÖ Registrar Venda</button>
            <button class="tab" onclick="openTab('lotes')">üìã Meus Lotes</button>
        </div>

        <div class="content">
            <!-- Dashboard -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard" id="dashboardCards"></div>
                <h2>Resumo dos Lotes</h2>
                <div id="dashboardTable"></div>
            </div>

            <!-- Nova Compra -->
            <div id="compra" class="tab-content">
                <h2>‚ûï Registrar Nova Compra</h2>
                <form onsubmit="adicionarCompra(event)">
                    <div class="form-group">
                        <label>Nome/Identifica√ß√£o do Lote:</label>
                        <input type="text" id="nomeLote" required placeholder="Ex: Lote 01 - Dell Inspiron">
                    </div>

                    <div class="form-group">
                        <label>Quantidade de Notebooks:</label>
                        <input type="number" id="quantidade" required min="1" placeholder="Ex: 3">
                    </div>

                    <div class="form-group">
                        <label>Valor Total da Compra (R$):</label>
                        <input type="number" id="valorCompra" required step="0.01" min="0" placeholder="Ex: 800.00">
                    </div>

                    <div class="form-group">
                        <label>Observa√ß√µes:</label>
                        <textarea id="observacoes" rows="3" placeholder="Detalhes, estado dos notebooks, etc."></textarea>
                    </div>

                    <button type="submit">üíæ Salvar Compra</button>
                </form>
            </div>

            <!-- Despesas -->
            <div id="despesas" class="tab-content">
                <h2>üí∞ Adicionar Despesas</h2>
                <div id="alertaDespesas"></div>
                <form onsubmit="adicionarDespesa(event)">
                    <div class="form-group">
                        <label>Selecione o Lote:</label>
                        <select id="loteDespesa" required></select>
                    </div>

                    <div class="form-group">
                        <label>Tipo de Despesa:</label>
                        <select id="tipoDespesa" required>
                            <option value="">Selecione...</option>
                            <option value="Manuten√ß√£o">Manuten√ß√£o/Reparo</option>
                            <option value="Comiss√£o ML">Comiss√£o Mercado Livre</option>
                            <option value="Frete">Frete</option>
                            <option value="Embalagem">Embalagem</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Valor da Despesa (R$):</label>
                        <input type="number" id="valorDespesa" required step="0.01" min="0" placeholder="Ex: 150.00">
                    </div>

                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <input type="text" id="descricaoDespesa" placeholder="Ex: Troca de HD, limpeza">
                    </div>

                    <button type="submit">üí∏ Adicionar Despesa</button>
                </form>
            </div>

            <!-- C√°lculo de Venda -->
            <div id="calculo" class="tab-content">
                <h2>üßÆ Calcular Pre√ßo de Venda</h2>
                <div id="alertaCalculo"></div>
                <form onsubmit="calcularVenda(event)">
                    <div class="form-group">
                        <label>Selecione o Lote:</label>
                        <select id="loteCalculo" required onchange="mostrarCustoAtual()"></select>
                    </div>

                    <div id="custoAtual" style="display:none;" class="resultado">
                        <h3>üìä Custos Atuais do Lote</h3>
                        <div class="resultado-item">
                            <span>Valor da Compra:</span>
                            <span id="custoCompra">R$ 0,00</span>
                        </div>
                        <div class="resultado-item">
                            <span>Total de Despesas:</span>
                            <span id="custoDespesas">R$ 0,00</span>
                        </div>
                        <div class="resultado-item">
                            <span>Custo Total:</span>
                            <span id="custoTotal">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Markup Desejado (%):</label>
                        <input type="number" id="markup" required step="0.01" min="0" placeholder="Ex: 40">
                    </div>

                    <button type="submit">üî¢ Calcular</button>
                </form>

                <div id="resultadoCalculo"></div>
            </div>

            <!-- Registrar Venda -->
            <div id="vendas" class="tab-content">
                <h2>‚úÖ Registrar Venda Realizada</h2>
                <div id="alertaVendas"></div>
                <form onsubmit="registrarVenda(event)">
                    <div class="form-group">
                        <label>Selecione o Lote:</label>
                        <select id="loteVenda" required onchange="mostrarValorPrevisto()"></select>
                    </div>

                    <div id="valorPrevisto" style="display:none;" class="resultado">
                        <h3>üí° Valor Previsto (√∫ltimo c√°lculo)</h3>
                        <div class="resultado-item">
                            <span>Markup Calculado:</span>
                            <span id="markupPrevisto">-</span>
                        </div>
                        <div class="resultado-item">
                            <span>Valor Previsto do Lote:</span>
                            <span id="valorPrevistoLote">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Valor Real da Venda (R$):</label>
                        <input type="number" id="valorVendaReal" required step="0.01" min="0" placeholder="Quanto voc√™ vendeu o lote inteiro">
                    </div>

                    <div class="form-group">
                        <label>Data da Venda:</label>
                        <input type="date" id="dataVenda" required>
                    </div>

                    <div class="form-group">
                        <label>Observa√ß√µes da Venda:</label>
                        <textarea id="obsVenda" rows="3" placeholder="Detalhes da venda, parcelamento, etc."></textarea>
                    </div>

                    <button type="submit">‚úÖ Confirmar Venda</button>
                </form>
            </div>

            <!-- Meus Lotes -->
            <div id="lotes" class="tab-content">
                <h2>üìã Todos os Lotes</h2>
                <div id="tabelaLotes"></div>
            </div>
        </div>
    </div>

    <script>
        // Carregar dados do localStorage
        function carregarDados() {
            const dados = localStorage.getItem('gestaoNotebooks');
            return dados ? JSON.parse(dados) : { lotes: [], despesas: [], vendas: [] };
        }

        // Salvar dados no localStorage
        function salvarDados(dados) {
            localStorage.setItem('gestaoNotebooks', JSON.stringify(dados));
        }

        // Trocar entre abas
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') atualizarDashboard();
            if (tabName === 'despesas') atualizarSelectDespesas();
            if (tabName === 'calculo') atualizarSelectCalculo();
            if (tabName === 'vendas') atualizarSelectVendas();
            if (tabName === 'lotes') atualizarTabelaLotes();
        }

        // Adicionar nova compra
        function adicionarCompra(e) {
            e.preventDefault();

            const dados = carregarDados();
            const novoLote = {
                id: Date.now(),
                nome: document.getElementById('nomeLote').value,
                quantidade: parseInt(document.getElementById('quantidade').value),
                valorCompra: parseFloat(document.getElementById('valorCompra').value),
                observacoes: document.getElementById('observacoes').value,
                data: new Date().toLocaleDateString('pt-BR'),
                status: 'Pendente',
                markupCalculado: null,
                valorPrevistoVenda: null
            };

            dados.lotes.push(novoLote);
            salvarDados(dados);

            alert('‚úÖ Lote adicionado com sucesso!');
            e.target.reset();
            atualizarDashboard();
        }

        // Adicionar despesa
        function adicionarDespesa(e) {
            e.preventDefault();

            const dados = carregarDados();
            const novaDespesa = {
                id: Date.now(),
                loteId: parseInt(document.getElementById('loteDespesa').value),
                tipo: document.getElementById('tipoDespesa').value,
                valor: parseFloat(document.getElementById('valorDespesa').value),
                descricao: document.getElementById('descricaoDespesa').value,
                data: new Date().toLocaleDateString('pt-BR')
            };

            dados.despesas.push(novaDespesa);
            salvarDados(dados);

            alert('‚úÖ Despesa adicionada com sucesso!');
            e.target.reset();
            atualizarSelectDespesas();
        }

        // Calcular custo total de um lote
        function calcularCustoLote(loteId) {
            const dados = carregarDados();
            const lote = dados.lotes.find(l => l.id === loteId);
            const despesasLote = dados.despesas.filter(d => d.loteId === loteId);
            const totalDespesas = despesasLote.reduce((sum, d) => sum + d.valor, 0);

            return {
                valorCompra: lote.valorCompra,
                totalDespesas: totalDespesas,
                custoTotal: lote.valorCompra + totalDespesas
            };
        }

        // Mostrar custo atual ao selecionar lote
        function mostrarCustoAtual() {
            const loteId = parseInt(document.getElementById('loteCalculo').value);
            if (!loteId) return;

            const custos = calcularCustoLote(loteId);
            document.getElementById('custoAtual').style.display = 'block';
            document.getElementById('custoCompra').textContent = formatarMoeda(custos.valorCompra);
            document.getElementById('custoDespesas').textContent = formatarMoeda(custos.totalDespesas);
            document.getElementById('custoTotal').textContent = formatarMoeda(custos.custoTotal);
        }

        // Calcular venda
        function calcularVenda(e) {
            e.preventDefault();

            const loteId = parseInt(document.getElementById('loteCalculo').value);
            const markup = parseFloat(document.getElementById('markup').value);
            const custos = calcularCustoLote(loteId);

            const valorVenda = custos.custoTotal * (1 + markup / 100);
            const lucro = valorVenda - custos.custoTotal;
            const margemLucro = (lucro / valorVenda) * 100;

            // Salvar o c√°lculo no lote
            const dados = carregarDados();
            const lote = dados.lotes.find(l => l.id === loteId);
            lote.markupCalculado = markup;
            lote.valorPrevistoVenda = valorVenda;
            salvarDados(dados);

            const resultado = `
                <div class="resultado">
                    <h3>üí∞ Resultado do C√°lculo</h3>
                    <div class="resultado-item">
                        <span>Custo Total do Lote:</span>
                        <span>${formatarMoeda(custos.custoTotal)}</span>
                    </div>
                    <div class="resultado-item">
                        <span>Markup Aplicado:</span>
                        <span>${markup}%</span>
                    </div>
                    <div class="resultado-item">
                        <span>Valor de Venda do Lote:</span>
                        <span>${formatarMoeda(valorVenda)}</span>
                    </div>
                    <div class="resultado-item">
                        <span>Lucro Previsto:</span>
                        <span>${formatarMoeda(lucro)}</span>
                    </div>
                    <div class="resultado-item">
                        <span>Margem de Lucro:</span>
                        <span>${margemLucro.toFixed(2)}%</span>
                    </div>
                </div>
            `;

            document.getElementById('resultadoCalculo').innerHTML = resultado;
        }

        // Mostrar valor previsto ao selecionar lote para venda
        function mostrarValorPrevisto() {
            const loteId = parseInt(document.getElementById('loteVenda').value);
            if (!loteId) return;

            const dados = carregarDados();
            const lote = dados.lotes.find(l => l.id === loteId);

            if (lote.valorPrevistoVenda) {
                document.getElementById('valorPrevisto').style.display = 'block';
                document.getElementById('markupPrevisto').textContent = lote.markupCalculado + '%';
                document.getElementById('valorPrevistoLote').textContent = formatarMoeda(lote.valorPrevistoVenda);
            } else {
                document.getElementById('valorPrevisto').style.display = 'none';
            }
        }

        // Registrar venda realizada
        function registrarVenda(e) {
            e.preventDefault();

            const loteId = parseInt(document.getElementById('loteVenda').value);
            const valorReal = parseFloat(document.getElementById('valorVendaReal').value);
            const dataVenda = document.getElementById('dataVenda').value;
            const obs = document.getElementById('obsVenda').value;

            const dados = carregarDados();
            const lote = dados.lotes.find(l => l.id === loteId);
            const custos = calcularCustoLote(loteId);

            const valorPrevisto = lote.valorPrevistoVenda || 0;
            const diferenca = valorReal - valorPrevisto;
            const lucroReal = valorReal - custos.custoTotal;
            const lucroPrevistoCalc = valorPrevisto - custos.custoTotal;
            const diferencaLucro = lucroReal - lucroPrevistoCalc;

            // Criar registro de venda
            const novaVenda = {
                id: Date.now(),
                loteId: loteId,
                valorReal: valorReal,
                valorPrevisto: valorPrevisto,
                diferenca: diferenca,
                custoTotal: custos.custoTotal,
                lucroReal: lucroReal,
                lucroPrevistoCalc: lucroPrevistoCalc,
                diferencaLucro: diferencaLucro,
                dataVenda: dataVenda,
                observacoes: obs
            };

            dados.vendas.push(novaVenda);

            // Atualizar status do lote
            lote.status = 'Vendido';
            lote.valorRealVenda = valorReal;
            lote.dataVenda = dataVenda;

            salvarDados(dados);

            // Mostrar resultado
            const positivo = diferenca >= 0;
            const icone = positivo ? 'üìà' : 'üìâ';

            alert(`‚úÖ Venda registrada com sucesso!

${icone} Voc√™ ${positivo ? 'GANHOU' : 'PERDEU'} ${formatarMoeda(Math.abs(diferenca))} em rela√ß√£o ao previsto!`);

            e.target.reset();
            document.getElementById('valorPrevisto').style.display = 'none';
            atualizarDashboard();
        }

        // Atualizar select de despesas
        function atualizarSelectDespesas() {
            const dados = carregarDados();
            const lotesPendentes = dados.lotes.filter(l => l.status === 'Pendente');

            const selectDespesa = document.getElementById('loteDespesa');
            selectDespesa.innerHTML = '<option value="">Selecione um lote...</option>';

            if (lotesPendentes.length === 0) {
                document.getElementById('alertaDespesas').innerHTML = '<div class="alerta">‚ö†Ô∏è Voc√™ precisa cadastrar um lote primeiro na aba "Nova Compra"</div>';
                selectDespesa.disabled = true;
            } else {
                document.getElementById('alertaDespesas').innerHTML = '';
                selectDespesa.disabled = false;
                lotesPendentes.forEach(lote => {
                    selectDespesa.innerHTML += `<option value="${lote.id}">${lote.nome}</option>`;
                });
            }
        }

        // Atualizar select de c√°lculo
        function atualizarSelectCalculo() {
            const dados = carregarDados();
            const lotesPendentes = dados.lotes.filter(l => l.status === 'Pendente');

            const selectCalculo = document.getElementById('loteCalculo');
            selectCalculo.innerHTML = '<option value="">Selecione um lote...</option>';

            if (lotesPendentes.length === 0) {
                document.getElementById('alertaCalculo').innerHTML = '<div class="alerta">‚ö†Ô∏è Voc√™ precisa cadastrar um lote primeiro na aba "Nova Compra"</div>';
                selectCalculo.disabled = true;
            } else {
                document.getElementById('alertaCalculo').innerHTML = '';
                selectCalculo.disabled = false;
                lotesPendentes.forEach(lote => {
                    selectCalculo.innerHTML += `<option value="${lote.id}">${lote.nome}</option>`;
                });
            }
        }

        // Atualizar select de vendas
        function atualizarSelectVendas() {
            const dados = carregarDados();
            const lotesPendentes = dados.lotes.filter(l => l.status === 'Pendente');

            const selectVenda = document.getElementById('loteVenda');
            selectVenda.innerHTML = '<option value="">Selecione um lote...</option>';

            if (lotesPendentes.length === 0) {
                document.getElementById('alertaVendas').innerHTML = '<div class="alerta">‚ö†Ô∏è Voc√™ precisa cadastrar um lote primeiro na aba "Nova Compra"</div>';
                selectVenda.disabled = true;
            } else {
                document.getElementById('alertaVendas').innerHTML = '';
                selectVenda.disabled = false;
                lotesPendentes.forEach(lote => {
                    selectVenda.innerHTML += `<option value="${lote.id}">${lote.nome}</option>`;
                });
            }
        }

        // Atualizar dashboard
        function atualizarDashboard() {
            const dados = carregarDados();

            const totalInvestido = dados.lotes.reduce((sum, l) => sum + l.valorCompra, 0);
            const totalDespesas = dados.despesas.reduce((sum, d) => sum + d.valor, 0);
            const totalCustos = totalInvestido + totalDespesas;
            const totalVendas = dados.vendas.reduce((sum, v) => sum + v.valorReal, 0);
            const lucroTotal = totalVendas - dados.vendas.reduce((sum, v) => sum + v.custoTotal, 0);

            const cards = `
                <div class="card">
                    <h3>üíº Total Investido</h3>
                    <div class="value">${formatarMoeda(totalInvestido)}</div>
                </div>
                <div class="card">
                    <h3>üí∏ Total Despesas</h3>
                    <div class="value">${formatarMoeda(totalDespesas)}</div>
                </div>
                <div class="card">
                    <h3>üìä Custo Total</h3>
                    <div class="value">${formatarMoeda(totalCustos)}</div>
                </div>
                <div class="card">
                    <h3>üí∞ Faturamento</h3>
                    <div class="value">${formatarMoeda(totalVendas)}</div>
                </div>
                <div class="card">
                    <h3>üéØ Lucro Total</h3>
                    <div class="value">${formatarMoeda(lucroTotal)}</div>
                </div>
            `;

            document.getElementById('dashboardCards').innerHTML = cards;

            // Tabela resumo
            let tabela = '<table><thead><tr><th>Lote</th><th>Custo Total</th><th>Previsto</th><th>Realizado</th><th>Diferen√ßa</th><th>Status</th></tr></thead><tbody>';

            if (dados.lotes.length === 0) {
                tabela += '<tr><td colspan="6" style="text-align:center; padding: 30px;">üì¶ Nenhum lote cadastrado ainda. V√° em "Nova Compra" para come√ßar!</td></tr>';
            } else {
                dados.lotes.forEach(lote => {
                    const custos = calcularCustoLote(lote.id);
                    const venda = dados.vendas.find(v => v.loteId === lote.id);
                    const valorRealizado = venda ? venda.valorReal : 0;
                    const valorPrevisto = lote.valorPrevistoVenda || 0;
                    const diferenca = venda ? venda.diferenca : 0;
                    const statusClass = lote.status === 'Vendido' ? 'status-vendido' : 'status-pendente';

                    tabela += `
                        <tr>
                            <td>${lote.nome}</td>
                            <td>${formatarMoeda(custos.custoTotal)}</td>
                            <td>${valorPrevisto > 0 ? formatarMoeda(valorPrevisto) : '-'}</td>
                            <td>${valorRealizado > 0 ? formatarMoeda(valorRealizado) : '-'}</td>
                            <td style="color: ${diferenca >= 0 ? '#00b894' : '#e74c3c'}; font-weight: bold;">
                                ${venda ? formatarMoeda(diferenca) : '-'}
                            </td>
                            <td><span class="status-badge ${statusClass}">${lote.status}</span></td>
                        </tr>
                    `;
                });
            }

            tabela += '</tbody></table>';
            document.getElementById('dashboardTable').innerHTML = tabela;
        }

        // Atualizar tabela de lotes
        function atualizarTabelaLotes() {
            const dados = carregarDados();

            let html = '<table><thead><tr><th>Lote</th><th>Qtd</th><th>Compra</th><th>Despesas</th><th>Custo Total</th><th>Previsto</th><th>Realizado</th><th>Lucro</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>';

            if (dados.lotes.length === 0) {
                html += '<tr><td colspan="10" style="text-align:center; padding: 30px;">üì¶ Nenhum lote cadastrado ainda. V√° em "Nova Compra" para come√ßar!</td></tr>';
            } else {
                dados.lotes.forEach(lote => {
                    const custos = calcularCustoLote(lote.id);
                    const venda = dados.vendas.find(v => v.loteId === lote.id);
                    const lucro = venda ? venda.lucroReal : 0;
                    const statusClass = lote.status === 'Vendido' ? 'status-vendido' : 'status-pendente';

                    html += `
                        <tr>
                            <td>${lote.nome}</td>
                            <td>${lote.quantidade}</td>
                            <td>${formatarMoeda(lote.valorCompra)}</td>
                            <td>${formatarMoeda(custos.totalDespesas)}</td>
                            <td>${formatarMoeda(custos.custoTotal)}</td>
                            <td>${lote.valorPrevistoVenda ? formatarMoeda(lote.valorPrevistoVenda) : '-'}</td>
                            <td>${venda ? formatarMoeda(venda.valorReal) : '-'}</td>
                            <td style="color: ${lucro >= 0 ? '#00b894' : '#e74c3c'}; font-weight: bold;">
                                ${venda ? formatarMoeda(lucro) : '-'}
                            </td>
                            <td><span class="status-badge ${statusClass}">${lote.status}</span></td>
                            <td><button class="btn-delete" onclick="deletarLote(${lote.id})">üóëÔ∏è</button></td>
                        </tr>
                    `;
                });
            }

            html += '</tbody></table>';
            document.getElementById('tabelaLotes').innerHTML = html;
        }

        // Deletar lote
        function deletarLote(loteId) {
            if (!confirm('Tem certeza que deseja deletar este lote?')) return;

            const dados = carregarDados();
            dados.lotes = dados.lotes.filter(l => l.id !== loteId);
            dados.despesas = dados.despesas.filter(d => d.loteId !== loteId);
            dados.vendas = dados.vendas.filter(v => v.loteId !== loteId);
            salvarDados(dados);

            atualizarTabelaLotes();
            atualizarDashboard();
        }

        // Formatar moeda
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // Inicializar
        window.onload = function() {
            atualizarDashboard();
            document.getElementById('dataVenda').valueAsDate = new Date();
        };
    </script>
</body>
</html>